name: Deploy üèóÔ∏è

on:
  workflow_call:
    inputs:
      branch:
        required: true
        type: string
      environment:
        required: true
        type: string
      artifact_name:
        required: false
        type: string
        default: package

jobs:
  deploy:
    name: Deploy to ${{ inputs.environment }} üìÉ
    runs-on: ubuntu-latest
    environment:
      name: ${{ inputs.environment }}
      url: https://${{ inputs.environment }}.titanos.jellyfin.org

    steps:
      - name: Download workflow artifact ‚¨áÔ∏è
        uses: actions/download-artifact@37930b1c2abaa49bbe596cd826c3c89aef350131 # v7.0.0
        with:
          name: ${{ inputs.artifact_name }}
          path: dist/package

      - name: Deploy to ${{ inputs.environment }}.titanos.jellyfin.org
        uses: burnett01/rsync-deployments@0c902521b8b9135f0dae7841a01d7d3b19629cb2 # 8.0.2
        with:
          switches: -vrptz
          path: dist/package/
          remote_path: /srv/titanos/${{ inputs.environment }}/
          remote_host: ${{ secrets.DEPLOY_APPS_HOST }}
          remote_user: ${{ secrets.DEPLOY_APPS_USER }}
          remote_key: ${{ secrets.DEPLOY_APPS_KEY }}
