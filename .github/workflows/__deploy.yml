name: Deploy üèóÔ∏è

on:
  workflow_call:
    inputs:
      branch:
        required: true
        type: string
      environment:
        required: true
        type: string
      artifact_name:
        required: false
        type: string
        default: package

jobs:
  deploy:
    name: Deploy to ${{ inputs.environment }} üìÉ
    runs-on: ubuntu-latest
    environment:
      name: ${{ inputs.environment }}
      url: https://${{ inputs.environment }}.titanos.jellyfin.org

    steps:
      - name: Download workflow artifact ‚¨áÔ∏è
        uses: actions/download-artifact@018cc2cf5baa6db3ef3c5f8a56943fffe632ef53 # v6.0.0
        with:
          name: ${{ inputs.artifact_name }}
          path: dist/package

      - name: Deploy to ${{ inputs.environment }}.titanos.jellyfin.org
        uses: burnett01/rsync-deployments@05a269aeea3e70e1e8fe77064e475a5cb2c80b20 # 8.0.0
        with:
          switches: -vrptz
          path: dist/package/
          remote_path: /srv/titanos/${{ inputs.environment }}/
          remote_host: ${{ secrets.DEPLOY_APPS_HOST }}
          remote_user: ${{ secrets.DEPLOY_APPS_USER }}
          remote_key: ${{ secrets.DEPLOY_APPS_KEY }}
